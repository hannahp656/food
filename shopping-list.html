<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Shopping List</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Inter:wght@300;400;600,700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: Montserrat, sans-serif;
      padding: 20px;
      background: #f8fbf6;
    }
    h1 {
      text-align: center;
      color: #3a4d39;
    }
    ul {
      list-style: none;
      padding: 0;
      margin: 20px 0;
    }
    li.shopping-item {
      background: #fff;
      padding: 10px 14px;
      margin-bottom: 8px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: grab;
    }
    li.shopping-item.dragging {
      opacity: 0.5;
    }
    input[type="checkbox"] {
      transform: scale(1.2);
    }
    .measures {
      color: #555;
    }
  </style>
</head>
<body>
  <h1>Shopping List</h1>
  <ul id="shoppingListContainer"></ul>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const container = document.getElementById("shoppingListContainer");
    let shoppingList = JSON.parse(localStorage.getItem("shoppingListData") || "[]");

    function renderShoppingList() {
      container.innerHTML = "";
      shoppingList.forEach((item, index) => {
        const li = document.createElement("li");
        li.className = "shopping-item";
        li.draggable = true;
        li.dataset.index = index;

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = item.checked;
        checkbox.addEventListener("change", () => {
          shoppingList[index].checked = checkbox.checked;
          saveList();
        });

        const text = document.createTextNode(`${item.ingredient} - `);
        const measuresSpan = document.createElement("span");
        measuresSpan.className = "measures";
        measuresSpan.textContent = item.measures.join(", ");

        li.appendChild(checkbox);
        li.appendChild(text);
        li.appendChild(measuresSpan);

        container.appendChild(li);
      });
    }

    function saveList() {
      localStorage.setItem("shoppingListData", JSON.stringify(shoppingList));
    }

    // Drag-and-drop
    let draggedIndex = null;
    container.addEventListener("dragstart", e => {
      if (e.target.classList.contains("shopping-item")) {
        draggedIndex = parseInt(e.target.dataset.index);
        e.target.classList.add("dragging");
      }
    });
    container.addEventListener("dragend", e => {
      if (e.target.classList.contains("shopping-item")) {
        e.target.classList.remove("dragging");
      }
    });
    container.addEventListener("dragover", e => {
      e.preventDefault();
      const afterElement = getDragAfterElement(container, e.clientY);
      const dragging = container.querySelector(".dragging");
      if (!dragging) return;
      if (afterElement == null) {
        container.appendChild(dragging);
      } else {
        container.insertBefore(dragging, afterElement);
      }
    });

    function getDragAfterElement(container, y) {
      const draggableElements = [...container.querySelectorAll(".shopping-item:not(.dragging)")];
      return draggableElements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;
        if (offset < 0 && offset > closest.offset) {
          return { offset: offset, element: child };
        } else {
          return closest;
        }
      }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    // Update the shoppingList order on drop
    container.addEventListener("drop", () => {
      shoppingList = [...container.querySelectorAll(".shopping-item")].map(li => {
        const index = parseInt(li.dataset.index);
        return shoppingList[index];
      });
      // Reset dataset.index
      container.querySelectorAll(".shopping-item").forEach((li, idx) => li.dataset.index = idx);
      saveList();
    });

    renderShoppingList();
  });
  </script>
</body>
</html>
